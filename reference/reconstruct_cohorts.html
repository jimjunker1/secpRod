<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>reconstruct_split_cohort — reconstruct_split_cohort • secpRod</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="reconstruct_split_cohort — reconstruct_split_cohort"><meta name="description" content="reconstruct_split_cohorts() is used to reconstruct a *non-overlapping* cohort sampled over two years, often with a period of
of zero abundance (e.g. due to egg or adult stages).
fit_with_offset() is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort.
plot_cohort_fit() is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort."><meta property="og:description" content="reconstruct_split_cohorts() is used to reconstruct a *non-overlapping* cohort sampled over two years, often with a period of
of zero abundance (e.g. due to egg or adult stages).
fit_with_offset() is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort.
plot_cohort_fit() is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">secpRod</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.101</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/model-testing.html">Testing models of secondary production: simple to advanced</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-simulation.html">Simulating the sampling of populations</a></li>
    <li><a class="dropdown-item" href="../articles/simple-example.html">A few simple examples</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jimjunker1/secpRod/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>reconstruct_split_cohort</h1>
      <small class="dont-index">Source: <a href="https://github.com/jimjunker1/secpRod/blob/main/R/reconstruct_cohorts.R" class="external-link"><code>R/reconstruct_cohorts.R</code></a></small>
      <div class="d-none name"><code>reconstruct_cohorts.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>reconstruct_split_cohorts()</code> is used to reconstruct a *non-overlapping* cohort sampled over two years, often with a period of
of zero abundance (e.g. due to egg or adult stages).</p>
<p><code>fit_with_offset()</code> is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort.</p>
<p><code>plot_cohort_fit()</code> is an internal function used in [reconstruct_split_cohort()] to fit growth functions to find the optimal cohort offset in a split cohort.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">reconstruct_split_cohort</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  timeCol <span class="op">=</span> <span class="st">"dateID"</span>,</span>
<span>  massCol <span class="op">=</span> <span class="st">"massValue"</span>,</span>
<span>  massDropThresh <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  tStart <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vbg"</span>, <span class="st">"gompertz"</span>, <span class="st">"logistic"</span>, <span class="st">"richards"</span><span class="op">)</span>,</span>
<span>  offsetBounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">150</span><span class="op">)</span>,</span>
<span>  fallbackGrid <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fit_with_offset</span><span class="op">(</span></span>
<span>  dfOrdered <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vbg"</span>, <span class="st">"gompertz"</span>, <span class="st">"logistic"</span>, <span class="st">"richards"</span><span class="op">)</span>,</span>
<span>  tStart <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_cohort_fit</span><span class="op">(</span><span class="va">remappedCohort</span>, models <span class="op">=</span> <span class="st">"ensemble"</span>, labelPoints <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>a data.frame of the sample-level observed masses and densities</p></dd>


<dt id="arg-timecol">timeCol<a class="anchor" aria-label="anchor" href="#arg-timecol"></a></dt>
<dd><p>character. String of the column name depicting the date of each sampling event.</p></dd>


<dt id="arg-masscol">massCol<a class="anchor" aria-label="anchor" href="#arg-masscol"></a></dt>
<dd><p>character. String of the column name containing mass data.</p></dd>


<dt id="arg-massdropthresh">massDropThresh<a class="anchor" aria-label="anchor" href="#arg-massdropthresh"></a></dt>
<dd><p>This is the proportional drop in mass used to detect the end and beginning of two cohort portions.</p></dd>


<dt id="arg-tstart">tStart<a class="anchor" aria-label="anchor" href="#arg-tstart"></a></dt>
<dd><p>data frame of date information with external predictors for each month. There should be a column name identical to all variables in the growth equation found in taxaInfo data.frame.</p></dd>


<dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>character. String vector of the names of models to fit to \(M_t\). See `details` for more information.</p></dd>


<dt id="arg-offsetbounds">offsetBounds<a class="anchor" aria-label="anchor" href="#arg-offsetbounds"></a></dt>
<dd><p>integer vector of length = 2. The lower and upper bounds of the offset to test for fit</p></dd>


<dt id="arg-fallbackgrid">fallbackGrid<a class="anchor" aria-label="anchor" href="#arg-fallbackgrid"></a></dt>
<dd><p>logical. If TRUE (default) a grid search procedure will be used if `optim()` fails.</p></dd>


<dt id="arg-dfordered">dfOrdered<a class="anchor" aria-label="anchor" href="#arg-dfordered"></a></dt>
<dd><p>the reordered sampling data set from [reconstruct_split_cohort()] processes</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>the offset (in days) between the final sample and first sample in two cohort portions to be joined</p></dd>


<dt id="arg-remappedcohort">remappedCohort<a class="anchor" aria-label="anchor" href="#arg-remappedcohort"></a></dt>
<dd><p>the reordered object returned from [reconstruct_split_cohort()]</p></dd>


<dt id="arg-labelpoints">labelPoints<a class="anchor" aria-label="anchor" href="#arg-labelpoints"></a></dt>
<dd><p>logical. Should the points be labelled with the sampling date information</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>resonstruct_split_cohort()</code> returns a dataframe with the original sampling date, estimated cohort ages, and remapped
cohort ages to fit production methods and remap back to original timescale.</p>
<p><code>fit_with_offset()</code> returns a list of three (3) objects:</p>
<p>fits: the growth model fits to reordered sampling dates</p>
<p>aiccs: the Akaike Information Criterion for each model. This is used to build ensemble model estimates for remapped cohort 'times'</p>
<p>df_pseudo: a data.frame of the original date, standardized cohort 'times', and t0 corrected ages estimated from the growth models.</p>
<p><code>plot_cohort_fit()</code> returns a ggplot object of the remapped cohort and growth model fits.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The initiation of a sampling program can often start when the growth of a population cohort is already underway, leading to observing only large, late instars individuals during early sampling events.
For univoltine species, this may be followed by a period of zero abundance (e.g., due to egg or adult stages) and subsequent sampling of early instars. To make inferences on cohort parameters
and use some model-based procedures to estimate production, it is useful to 're-order' the sampling dates to create a continuous cohort progression. This makes some assumptions. For more details on these,
see the _sampling simulation vignette_. This function reorders partial cohorts (e.g., late
instars at the beginning and early instars in later sampling in an annual regime. To do this, the model fits growth functions to remap split cohorts to a continuous progression in time. The difficult
aspect of this is estimating the relative cohort age of different sampling events for correct ordering when there may be a long period between. Crucially, we don't observe the beginning or end of a full
cohort, we only have information from our distinct sampling events. This function fits growth models to estimate the cohort ages of each sample and remap into cohort progression.</p>
<p>Models are fit to mean cohort mass at each sampling event, \(M_{t}\) and return estimates for asymptotic mass, \(M_{\infty}\), time at mass = 0, \(t_0\) (or time at growth inflection, \(t*\),
depending on model which is used to estimate \(t_0\)), and growth rate, \(k\). These  Current models available are:</p>
<p>"vbg" The 'regular' von Bertalanffy growth model: $$M_{t} = M_{\infty} (1 -e^{-k \cdot (t - t_0)})$$
     "gompertz" The Gompertz growth model: $$M_t = M_{\infty} e^{e^{-k \cdot (t - t*)}}$$
     "logistic" The logistic growth model: $$M_t = M_{\infty} / (1 + e^{-k \cdot (t - t*)})$$
     "richards" The Richards growth model: $$M_t = M_{\infty} (1 + 1/D \cdot e^{-k \cdot (t - t*)})^{-D}$$</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jim Junker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

